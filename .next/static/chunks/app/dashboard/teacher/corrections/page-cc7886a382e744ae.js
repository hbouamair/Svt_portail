(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[834],{5469:(e,r,a)=>{Promise.resolve().then(a.bind(a,5377))},5377:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>A});var s=a(95155),l=a(12115),t=a(33473),n=a(67401);let i=(0,n.A)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var o=a(14081);let d=(0,n.A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),c=(0,n.A)("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);var u=a(45686),m=a(14085),x=a(35007),p=a(9955),h=a(15785),v=a(7837),f=a(30814),g=a(37334),j=a(63259),b=a(6888),y=a(66796),N=a(71183),w=a(30329),k=a(29602);let C=[{value:"",label:"— Aucun —"},{value:"DS1",label:"DS1"},{value:"DS2",label:"DS2"},{value:"DS3",label:"DS3"},{value:"Contr\xf4le",label:"Contr\xf4le"},{value:"Partiel",label:"Partiel"},{value:"Oral",label:"Oral"},{value:"Autre",label:"Autre"}];function A(){let{useSupabase:e}=(0,b.A)(),{data:r,loading:a}=(0,g.gR)(),{data:n,loading:A,addCorrection:D,deleteCorrection:S}=(0,g.HX)(),[F,M]=l.useState(!1),[P,T]=l.useState(!1),[E,q]=l.useState(""),[z,O]=l.useState(""),[L,_]=l.useState(null),[H,$]=l.useState(null),[G,V]=l.useState(!1),[J,Z]=l.useState(null),[R,U]=l.useState(!1),I=l.useRef(null),W=l.useMemo(()=>(function(e,r){var a,s,l;let t=new Map;for(let r of e){let e=null!==(a=r.classId)&&void 0!==a?a:null;t.has(e)||t.set(e,[]),t.get(e).push(r)}let n=[];for(let e of Array.from(t.keys()).sort((e,a)=>{var s,l,t,n;if(null===e)return -1;if(null===a)return 1;let i=null!==(t=null===(s=r.find(r=>r.id===e))||void 0===s?void 0:s.name)&&void 0!==t?t:"",o=null!==(n=null===(l=r.find(e=>e.id===a))||void 0===l?void 0:l.name)&&void 0!==n?n:"";return i.localeCompare(o)})){let a=t.get(e),i=null===e?"Toutes classes":null!==(l=null===(s=r.find(r=>r.id===e))||void 0===s?void 0:s.name)&&void 0!==l?l:"Classe",o=new Map;for(let e of a){let r=function(e){let r=e.indexOf(" — ");return r>0?e.slice(0,r).trim():"Sans type"}(e.title);o.has(r)||o.set(r,[]),o.get(r).push(e)}let d=Array.from(o.entries()).sort((e,r)=>{let[a]=e,[s]=r;return"Sans type"===a?1:"Sans type"===s?-1:a.localeCompare(s)}).map(e=>{let[r,a]=e;return{controle:r,items:a.sort((e,r)=>new Date(r.uploadedAt).getTime()-new Date(e.uploadedAt).getTime())}});n.push({classLabel:i,classId:e,groups:d})}return n})(n,r),[n,r]),X=async r=>{if(r.preventDefault(),!H||!E.trim())return;let a=z.trim()?"".concat(z.trim()," — ").concat(E.trim()):E.trim();T(!0);try{let r=(0,j.A)();if(e&&r){let e=H.name.replace(/[^a-zA-Z0-9._-]/g,"_"),s="".concat(Date.now(),"-").concat(e),{error:l}=await r.storage.from("corrections").upload(s,H,{contentType:H.type||"application/pdf"});if(l)throw Error(l.message);await D({title:a,classId:L,filePath:s,fileName:H.name})}else{let e=new FormData;e.append("file",H);let r=await fetch("/api/corrections/upload",{method:"POST",body:e});if(!r.ok)throw Error("Upload failed");let{fileUrl:s,fileName:l}=await r.json();await D({title:a,classId:L,filePath:l,fileName:l})}q(""),O(""),_(null),$(null),M(!1),f.o.success("Correction ajout\xe9e.")}catch(e){console.error(e),f.o.error(e instanceof Error?e.message:"Erreur lors de l'upload.")}finally{T(!1)}},B=async()=>{if(J){U(!0);try{await S(J.id,J.filePath),f.o.success("Correction supprim\xe9e."),Z(null)}catch(e){console.error(e),f.o.error("Erreur lors de la suppression.")}finally{U(!1)}}},K=()=>{q(""),O(""),_(null),$(null),M(!0)};return(0,s.jsxs)("div",{className:"space-y-6 sm:space-y-8",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-end sm:justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"font-display text-2xl font-semibold tracking-tight sm:text-3xl",children:"Corrections PDF"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-[var(--muted-foreground)] sm:text-base",children:"D\xe9posez les corrections d'examens par classe et par contr\xf4le pour les rendre accessibles aux \xe9l\xe8ves."})]}),(0,s.jsxs)(m.$,{onClick:K,className:"gap-2 rounded-xl shadow-lg shadow-[var(--primary)]/20 sm:shrink-0",children:[(0,s.jsx)(t.A,{className:"h-4 w-4"}),"Ajouter une correction"]})]}),(0,s.jsx)(v.lG,{open:F,onOpenChange:M,children:(0,s.jsxs)(v.Cf,{className:"max-h-[90vh] overflow-y-auto rounded-2xl border-[var(--border)] bg-[var(--card)] sm:max-w-lg",children:[(0,s.jsxs)(v.c7,{children:[(0,s.jsxs)(v.L3,{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"flex h-9 w-9 items-center justify-center rounded-lg bg-[var(--primary)]/20 text-[var(--primary)]",children:(0,s.jsx)(i,{className:"h-4 w-4"})}),"Ajouter une correction"]}),(0,s.jsx)(v.rr,{children:"Titre, type de contr\xf4le (optionnel), classe (optionnelle) et fichier PDF."})]}),(0,s.jsxs)("form",{onSubmit:X,className:"space-y-4 pt-2",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(h.J,{htmlFor:"correction-title",children:"Titre"}),(0,s.jsx)(p.p,{id:"correction-title",value:E,onChange:e=>q(e.target.value),placeholder:"Ex. Correction G\xe9ologie",required:!0,"aria-required":"true",className:"h-11 rounded-xl border-[var(--border)] bg-[var(--background)]/50"})]}),(0,s.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(h.J,{htmlFor:"correction-controle",children:"Type de contr\xf4le"}),(0,s.jsx)("select",{id:"correction-controle",value:z,onChange:e=>O(e.target.value),className:"flex h-11 w-full rounded-xl border border-[var(--border)] bg-[var(--background)]/50 px-3 py-2 text-sm",children:C.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value||"none"))})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(h.J,{htmlFor:"correction-class",children:"Classe"}),(0,s.jsxs)("select",{id:"correction-class",value:null!=L?L:"",onChange:e=>_(e.target.value||null),className:"flex h-11 w-full rounded-xl border border-[var(--border)] bg-[var(--background)]/50 px-3 py-2 text-sm",children:[(0,s.jsx)("option",{value:"",children:"Toutes les classes"}),r.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(h.J,{children:"Fichier PDF"}),(0,s.jsxs)("div",{onDrop:e=>{var r;e.preventDefault(),V(!1);let a=null===(r=e.dataTransfer.files)||void 0===r?void 0:r[0];(null==a?void 0:a.type)==="application/pdf"?$(a):a&&f.o.error("Seuls les fichiers PDF sont accept\xe9s.")},onDragOver:e=>{e.preventDefault(),V(!0)},onDragLeave:()=>V(!1),onClick:()=>{var e;return null===(e=I.current)||void 0===e?void 0:e.click()},className:(0,k.cn)("flex min-h-[120px] cursor-pointer flex-col items-center justify-center gap-2 rounded-2xl border-2 border-dashed px-4 py-5 transition-colors",G?"border-[var(--primary)] bg-[var(--primary)]/10":"border-[var(--border)] bg-[var(--muted)]/20 hover:border-[var(--primary)]/50 hover:bg-[var(--muted)]/30"),children:[(0,s.jsx)("input",{ref:I,id:"correction-file",type:"file",accept:".pdf,application/pdf",onChange:e=>{var r,a;return $(null!==(a=null===(r=e.target.files)||void 0===r?void 0:r[0])&&void 0!==a?a:null)},className:"sr-only","aria-required":"true"}),H?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.A,{className:"h-9 w-9 text-[var(--primary)]"}),(0,s.jsx)("p",{className:"text-center text-sm font-medium text-[var(--foreground)] truncate max-w-full px-2",children:H.name}),(0,s.jsx)("p",{className:"text-xs text-[var(--muted-foreground)]",children:"Cliquez ou glissez pour remplacer"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i,{className:"h-9 w-9 text-[var(--muted-foreground)]"}),(0,s.jsx)("p",{className:"text-center text-sm font-medium text-[var(--foreground)]",children:"Glissez un PDF ou cliquez"}),(0,s.jsx)("p",{className:"text-xs text-[var(--muted-foreground)]",children:"PDF uniquement"})]})]})]}),(0,s.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,s.jsx)(m.$,{type:"button",variant:"outline",className:"rounded-xl",onClick:()=>M(!1),children:"Annuler"}),(0,s.jsx)(m.$,{type:"submit",disabled:P||!H||!E.trim(),className:"flex-1 rounded-xl font-medium",children:P?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d,{className:"h-4 w-4 animate-spin"}),"Envoi…"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i,{className:"h-4 w-4"}),"Envoyer"]})})]})]})]})}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h2",{className:"font-display text-lg font-semibold sm:text-xl",children:"Corrections d\xe9pos\xe9es"}),n.length>0&&(0,s.jsxs)("span",{className:"text-sm text-[var(--muted-foreground)]",children:[n.length," document",1!==n.length?"s":""]})]}),(a||A)&&0===n.length?(0,s.jsx)("div",{className:"rounded-2xl border border-[var(--border)] bg-[var(--card)] p-8 sm:p-12",children:(0,s.jsx)(y.G,{message:"Chargement des corrections…"})}):0===n.length?(0,s.jsx)(x.Zp,{className:"border-[var(--border)] bg-[var(--card)]",children:(0,s.jsx)(x.Wu,{className:"p-8 sm:p-12",children:(0,s.jsx)(N.p,{icon:(0,s.jsx)(o.A,{className:"h-12 w-12 text-[var(--muted-foreground)]"}),title:"Aucune correction",description:"Cliquez sur \xab Ajouter une correction \xbb pour d\xe9poser un PDF.",action:(0,s.jsxs)(m.$,{onClick:K,className:"rounded-xl gap-2",children:[(0,s.jsx)(t.A,{className:"h-4 w-4"}),"Ajouter une correction"]})})})}):(0,s.jsx)("div",{className:"space-y-8",children:W.map(e=>{let{classLabel:r,classId:a,groups:l}=e;return(0,s.jsxs)(x.Zp,{className:"overflow-hidden border-[var(--border)] bg-[var(--card)]",children:[(0,s.jsxs)("div",{className:"border-b border-[var(--border)] bg-[var(--muted)]/20 px-4 py-3 sm:px-6",children:[(0,s.jsx)("h3",{className:"font-display font-semibold text-[var(--foreground)]",children:r}),(0,s.jsxs)("p",{className:"text-xs text-[var(--muted-foreground)] mt-0.5",children:[l.reduce((e,r)=>e+r.items.length,0)," correction",1!==l.reduce((e,r)=>e+r.items.length,0)?"s":""]})]}),(0,s.jsx)(x.Wu,{className:"p-0",children:l.map(e=>{let{controle:r,items:a}=e;return(0,s.jsxs)("div",{className:"border-b border-[var(--border)]/50 last:border-b-0",children:[(0,s.jsx)("div",{className:"bg-[var(--muted)]/10 px-4 py-2 sm:px-6",children:(0,s.jsx)("span",{className:"text-sm font-medium text-[var(--muted-foreground)]",children:r})}),(0,s.jsx)("ul",{className:"divide-y divide-[var(--border)]/50",children:a.map(e=>(0,s.jsxs)("li",{className:"flex flex-col gap-2 px-4 py-3 sm:flex-row sm:items-center sm:justify-between sm:px-6 sm:py-3",children:[(0,s.jsxs)("div",{className:"flex min-w-0 flex-1 items-center gap-3",children:[(0,s.jsx)("span",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-[var(--primary)]/15 text-[var(--primary)]",children:(0,s.jsx)(o.A,{className:"h-5 w-5"})}),(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("p",{className:"font-medium text-[var(--foreground)] truncate",children:e.title}),(0,s.jsx)("p",{className:"text-xs text-[var(--muted-foreground)]",children:new Date(e.uploadedAt).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"})})]})]}),(0,s.jsxs)("div",{className:"flex shrink-0 items-center gap-2 sm:pl-4",children:[(0,s.jsxs)("a",{href:e.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1.5 rounded-lg bg-[var(--primary)]/15 px-3 py-2 text-sm font-medium text-[var(--primary)] transition-colors hover:bg-[var(--primary)]/25",children:[(0,s.jsx)(c,{className:"h-4 w-4"}),"Voir"]}),(0,s.jsx)(m.$,{variant:"ghost",size:"icon",onClick:()=>Z(e),className:"h-9 w-9 shrink-0 text-red-500 hover:bg-red-500/10","aria-label":"Supprimer cette correction",children:(0,s.jsx)(u.A,{className:"h-4 w-4"})})]})]},e.id))})]},r)})})]},null!=a?a:"all")})}),(0,s.jsx)(w.T,{open:!!J,onOpenChange:e=>!e&&Z(null),title:"Supprimer cette correction ?",description:"Le fichier PDF sera \xe9galement supprim\xe9 du stockage.",confirmLabel:"Supprimer",cancelLabel:"Annuler",variant:"destructive",onConfirm:B,loading:R})]})}},30329:(e,r,a)=>{"use strict";a.d(r,{T:()=>n});var s=a(95155),l=a(7837),t=a(14085);function n(e){let{open:r,onOpenChange:a,title:n,description:i,confirmLabel:o="Confirmer",cancelLabel:d="Annuler",variant:c="default",onConfirm:u,loading:m=!1}=e,x=async()=>{await u(),a(!1)};return(0,s.jsx)(l.lG,{open:r,onOpenChange:a,children:(0,s.jsxs)(l.Cf,{className:"rounded-2xl border-[var(--border)] bg-[var(--card)]",children:[(0,s.jsxs)(l.c7,{children:[(0,s.jsx)(l.L3,{children:n}),i&&(0,s.jsx)(l.rr,{children:i})]}),(0,s.jsxs)(l.Es,{className:"gap-2 sm:gap-0",children:[(0,s.jsx)(t.$,{variant:"outline",onClick:()=>a(!1),disabled:m,className:"rounded-xl",children:d}),(0,s.jsx)(t.$,{variant:"destructive"===c?"destructive":"default",onClick:x,disabled:m,className:"rounded-xl",children:m?"Chargement…":o})]})]})})}},14081:(e,r,a)=>{"use strict";a.d(r,{A:()=>s});let s=(0,a(67401).A)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},45686:(e,r,a)=>{"use strict";a.d(r,{A:()=>s});let s=(0,a(67401).A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])}},e=>{var r=r=>e(e.s=r);e.O(0,[352,525,814,130,888,95,441,517,358],()=>r(5469)),_N_E=e.O()}]);