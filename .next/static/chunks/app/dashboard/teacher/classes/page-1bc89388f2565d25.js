(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[59],{86480:(e,s,a)=>{Promise.resolve().then(a.bind(a,40160))},40160:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>w});var l=a(95155),r=a(12115),n=a(92823),t=a(67401);let i=(0,t.A)("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),c=(0,t.A)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);var d=a(45686);let o=(0,t.A)("UserMinus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);var u=a(33473),m=a(14085),x=a(35007),h=a(9955),p=a(15785),j=a(7837),v=a(30814),f=a(77139),y=a(37334),g=a(6888),N=a(66796),b=a(71183),C=a(30329);function k(e){let{c:s,onEdit:a,onRequestRemoveClass:t,onOpenAddStudent:u,onRefetchClasses:h,refreshStudentsTrigger:p,onStudentsRefetched:j}=e,{data:f,removeStudentFromClass:g,refetch:N}=(0,y.uG)(s.id),[k,w]=r.useState(null),[S,A]=r.useState(!1);r.useEffect(()=>{p===s.id&&N().then(j)},[p,s.id,N,j]);let E=async()=>{if(k){A(!0);try{await g(k),h(),w(null)}catch(e){v.o.error(e instanceof Error?e.message:"Erreur")}finally{A(!1)}}};return(0,l.jsxs)(x.Zp,{className:"card-modern overflow-hidden border-[var(--border)] bg-[var(--card)]",children:[(0,l.jsx)(x.aR,{className:"border-b border-[var(--border)]/50 bg-[var(--muted)]/20",children:(0,l.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("div",{className:"flex h-12 w-12 items-center justify-center rounded-xl bg-[var(--primary)]/20 text-[var(--primary)]",children:(0,l.jsx)(n.A,{className:"h-6 w-6"})}),(0,l.jsx)(x.ZB,{className:"text-xl",children:s.name}),(0,l.jsx)(m.$,{variant:"ghost",size:"icon",onClick:()=>a(s),className:"rounded-lg",children:(0,l.jsx)(i,{className:"h-4 w-4"})})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsxs)(m.$,{variant:"outline",size:"sm",className:"gap-2 rounded-xl",onClick:()=>u(s.id),children:[(0,l.jsx)(c,{className:"h-4 w-4"}),"Ajouter un \xe9l\xe8ve"]}),(0,l.jsx)(m.$,{variant:"ghost",size:"icon",onClick:()=>t(s.id),className:"rounded-lg text-red-500 hover:bg-red-500/10","aria-label":"Supprimer cette classe",children:(0,l.jsx)(d.A,{className:"h-4 w-4"})})]})]})}),(0,l.jsxs)(x.Wu,{className:"p-6",children:[(0,l.jsxs)("p",{className:"mb-3 text-sm font-medium text-[var(--muted-foreground)]",children:[f.length," \xe9l\xe8ve",1!==f.length?"s":""," dans la classe"]}),(0,l.jsx)("ul",{className:"space-y-2",children:f.map(e=>(0,l.jsxs)("li",{className:"flex items-center justify-between rounded-xl border border-[var(--border)] bg-[var(--muted)]/30 px-4 py-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-medium",children:e.name}),(0,l.jsx)("p",{className:"text-xs text-[var(--muted-foreground)]",children:e.email})]}),(0,l.jsx)(m.$,{variant:"ghost",size:"icon",onClick:()=>w(e.id),className:"shrink-0 rounded-lg text-red-500 hover:bg-red-500/10",title:"Retirer de la classe","aria-label":"Retirer ".concat(e.name," de la classe"),children:(0,l.jsx)(o,{className:"h-4 w-4"})})]},e.id))}),0===f.length&&(0,l.jsx)(b.p,{icon:(0,l.jsx)(n.A,{className:"h-10 w-10"}),title:"Aucun \xe9l\xe8ve",description:'Cliquez sur "Ajouter un \xe9l\xe8ve" pour en ajouter \xe0 cette classe.'})]}),(0,l.jsx)(C.T,{open:!!k,onOpenChange:e=>!e&&w(null),title:"Retirer cet \xe9l\xe8ve de la classe ?",description:"L’\xe9l\xe8ve ne sera plus dans cette classe mais conservera son compte.",confirmLabel:"Retirer",cancelLabel:"Annuler",variant:"destructive",onConfirm:E,loading:S})]})}function w(){let{allUsers:e,useSupabase:s,refetchProfiles:a}=(0,g.A)(),[t,i]=r.useState(null),[c,d]=r.useState(""),[o,x]=r.useState(!1),[w,S]=r.useState(null),[A,E]=r.useState(""),[T,$]=r.useState(""),[L,M]=r.useState(""),[O,z]=r.useState(!1),[R,q]=r.useState(null),[G,F]=r.useState(!1),[V,_]=r.useState(null),{data:J,loading:B,error:H,refetch:I,addClass:P,updateClass:U,deleteClass:D}=(0,y.gR)(),Z=(0,y.uG)(w);r.useEffect(()=>{H&&v.o.error(H)},[H]);let W=()=>{d(""),x(!0)},K=async()=>{if(c.trim()){z(!0);try{await P(c.trim()),d(""),x(!1),v.o.success("Classe cr\xe9\xe9e.")}catch(e){v.o.error(e instanceof Error?e.message:"Erreur lors de la cr\xe9ation.")}finally{z(!1)}}},Q=e=>{i(e.id),d(e.name)},X=async()=>{if(!t||!c.trim())return;let e=J.find(e=>e.id===t);if(e){z(!0);try{await U(t,c.trim(),e.studentIds),i(null),d(""),v.o.success("Classe modifi\xe9e.")}catch(e){v.o.error(e instanceof Error?e.message:"Erreur lors de l’enregistrement.")}finally{z(!1)}}},Y=async()=>{if(R){F(!0);try{await D(R),v.o.success("Classe supprim\xe9e."),q(null)}catch(e){v.o.error(e instanceof Error?e.message:"Erreur lors de la suppression.")}finally{F(!1)}}},ee=e=>{S(e),E(""),$(""),M("")},es=async l=>{if(l.preventDefault(),!w||(M(""),!A.trim()||!T.trim()))return;let r=T.trim().toLowerCase(),n=e.find(e=>e.email.toLowerCase()===r),t=J.find(e=>e.id===w);if(t){z(!0);try{if(s){let e;if(n){if(t.studentIds.includes(n.id)){let e="Cet \xe9l\xe8ve est d\xe9j\xe0 dans la classe.";M(e),v.o.error(e);return}e=n.id}else{let s=await fetch("/api/users/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r,name:A.trim()})}),l=await s.json().catch(()=>({}));if(!s.ok){var i;let e=null!==(i=null==l?void 0:l.error)&&void 0!==i?i:"Impossible de cr\xe9er le compte.";M(e),v.o.error(e);return}e=l.id,await a()}await Z.addStudentToClass(e),I(),_(w),E(""),$(""),S(null),v.o.success("\xc9l\xe8ve ajout\xe9 \xe0 la classe.")}else{if(n){if(t.studentIds.includes(n.id)){let e="Cet \xe9l\xe8ve est d\xe9j\xe0 dans la classe.";M(e),v.o.error(e);return}await Z.addStudentToClass(n.id)}else{let e=(0,f.jw)(A.trim(),T.trim());await Z.addStudentToClass(e.id)}I(),_(w),E(""),$(""),S(null),v.o.success("\xc9l\xe8ve ajout\xe9 \xe0 la classe.")}}catch(s){let e=s instanceof Error?s.message:"Erreur";M(e),v.o.error(e)}finally{z(!1)}}},ea=w?J.find(e=>e.id===w):null,el=t?J.find(e=>e.id===t):null;return B&&0===J.length?(0,l.jsx)("div",{className:"flex items-center justify-center py-16",children:(0,l.jsx)(N.G,{message:"Chargement des classes…"})}):(0,l.jsxs)("div",{className:"space-y-8",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"font-display text-2xl font-semibold tracking-tight",children:"Classes"}),(0,l.jsx)("p",{className:"text-[var(--muted-foreground)]",children:"Cr\xe9ez des classes et ajoutez les \xe9l\xe8ves \xe0 chaque classe."})]}),(0,l.jsxs)(m.$,{onClick:W,className:"gap-2 rounded-xl shadow-lg shadow-[var(--primary)]/20",children:[(0,l.jsx)(u.A,{className:"h-4 w-4"}),"Nouvelle classe"]})]}),H&&(0,l.jsx)("p",{className:"rounded-xl bg-red-500/10 px-4 py-3 text-sm text-red-500",children:H}),(0,l.jsx)(j.lG,{open:o,onOpenChange:x,children:(0,l.jsxs)(j.Cf,{className:"rounded-2xl border-[var(--border)] bg-[var(--card)]",children:[(0,l.jsxs)(j.c7,{children:[(0,l.jsx)(j.L3,{children:"Nouvelle classe"}),(0,l.jsx)(j.rr,{children:"Ex. 2 Bac SVT, 1\xe8re Sp\xe9 SVT"})]}),(0,l.jsx)("div",{className:"space-y-4 py-2",children:(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(p.J,{htmlFor:"new-class-name",children:"Nom de la classe"}),(0,l.jsx)(h.p,{id:"new-class-name",value:c,onChange:e=>d(e.target.value),placeholder:"Ex. 2 Bac SVT",className:"rounded-xl",autoFocus:!0})]})}),(0,l.jsxs)(j.Es,{className:"gap-2 sm:gap-0",children:[(0,l.jsx)(m.$,{variant:"outline",onClick:()=>x(!1),className:"rounded-xl",children:"Annuler"}),(0,l.jsx)(m.$,{onClick:K,disabled:!c.trim()||O,className:"rounded-xl",children:O?"Cr\xe9ation…":"Cr\xe9er"})]})]})}),(0,l.jsx)(j.lG,{open:!!t,onOpenChange:e=>!e&&i(null),children:(0,l.jsxs)(j.Cf,{className:"rounded-2xl border-[var(--border)] bg-[var(--card)]",children:[(0,l.jsxs)(j.c7,{children:[(0,l.jsx)(j.L3,{children:"Modifier la classe"}),(0,l.jsx)(j.rr,{children:el?el.name:""})]}),(0,l.jsx)("div",{className:"space-y-4 py-2",children:(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(p.J,{htmlFor:"edit-class-name",children:"Nom de la classe"}),(0,l.jsx)(h.p,{id:"edit-class-name",value:c,onChange:e=>d(e.target.value),placeholder:"Ex. 2 Bac SVT",className:"rounded-xl",autoFocus:!0})]})}),(0,l.jsxs)(j.Es,{className:"gap-2 sm:gap-0",children:[(0,l.jsx)(m.$,{variant:"outline",onClick:()=>i(null),className:"rounded-xl",children:"Annuler"}),(0,l.jsx)(m.$,{onClick:X,disabled:!c.trim()||O,className:"rounded-xl",children:O?"Enregistrement…":"Enregistrer"})]})]})}),(0,l.jsx)(j.lG,{open:!!w,onOpenChange:e=>!e&&S(null),children:(0,l.jsxs)(j.Cf,{className:"rounded-2xl border-[var(--border)] bg-[var(--card)]",children:[(0,l.jsxs)(j.c7,{children:[(0,l.jsx)(j.L3,{children:"Ajouter un \xe9l\xe8ve"}),(0,l.jsxs)(j.rr,{children:[ea?"Dans la classe : ".concat(ea.name):"",!s&&" Si l’email existe d\xe9j\xe0, l’\xe9l\xe8ve sera ajout\xe9. Sinon un nouveau compte est cr\xe9\xe9 (mot de passe : eleve123).",s&&" Si l’email n’existe pas encore, un compte \xe9l\xe8ve sera cr\xe9\xe9 (mot de passe : eleve123)."]})]}),(0,l.jsxs)("form",{onSubmit:es,className:"space-y-4 py-2",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(p.J,{htmlFor:"student-name",children:"Nom"}),(0,l.jsx)(h.p,{id:"student-name",value:A,onChange:e=>E(e.target.value),placeholder:"Nom de l'\xe9l\xe8ve",className:"rounded-xl",required:!0})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(p.J,{htmlFor:"student-email",children:"Email"}),(0,l.jsx)(h.p,{id:"student-email",type:"email",value:T,onChange:e=>$(e.target.value),placeholder:"email@exemple.fr",className:"rounded-xl",required:!0,"aria-describedby":L?"add-student-error":void 0,"aria-invalid":!!L})]}),L&&(0,l.jsx)("p",{id:"add-student-error",role:"alert",className:"text-sm text-red-500",children:L}),(0,l.jsxs)(j.Es,{className:"gap-2 sm:gap-0",children:[(0,l.jsx)(m.$,{type:"button",variant:"outline",onClick:()=>S(null),className:"rounded-xl",children:"Annuler"}),(0,l.jsx)(m.$,{type:"submit",className:"rounded-xl",disabled:O,children:O?"Ajout…":"Ajouter"})]})]})]})}),(0,l.jsx)("div",{className:"space-y-6",children:J.map(e=>(0,l.jsx)(k,{c:e,onEdit:Q,onRequestRemoveClass:q,onOpenAddStudent:ee,onRefetchClasses:I,refreshStudentsTrigger:V,onStudentsRefetched:()=>_(null)},e.id))}),0===J.length&&(0,l.jsx)(b.p,{icon:(0,l.jsx)(n.A,{className:"h-12 w-12"}),title:"Aucune classe",description:"Cr\xe9ez une classe pour commencer.",action:(0,l.jsx)(m.$,{onClick:W,className:"rounded-xl",children:"Cr\xe9er une classe"})}),(0,l.jsx)(C.T,{open:!!R,onOpenChange:e=>!e&&q(null),title:"Supprimer cette classe ?",description:"Les \xe9l\xe8ves ne seront pas supprim\xe9s, uniquement l’affectation \xe0 cette classe.",confirmLabel:"Supprimer",cancelLabel:"Annuler",variant:"destructive",onConfirm:Y,loading:G})]})}},30329:(e,s,a)=>{"use strict";a.d(s,{T:()=>t});var l=a(95155),r=a(7837),n=a(14085);function t(e){let{open:s,onOpenChange:a,title:t,description:i,confirmLabel:c="Confirmer",cancelLabel:d="Annuler",variant:o="default",onConfirm:u,loading:m=!1}=e,x=async()=>{await u(),a(!1)};return(0,l.jsx)(r.lG,{open:s,onOpenChange:a,children:(0,l.jsxs)(r.Cf,{className:"rounded-2xl border-[var(--border)] bg-[var(--card)]",children:[(0,l.jsxs)(r.c7,{children:[(0,l.jsx)(r.L3,{children:t}),i&&(0,l.jsx)(r.rr,{children:i})]}),(0,l.jsxs)(r.Es,{className:"gap-2 sm:gap-0",children:[(0,l.jsx)(n.$,{variant:"outline",onClick:()=>a(!1),disabled:m,className:"rounded-xl",children:d}),(0,l.jsx)(n.$,{variant:"destructive"===o?"destructive":"default",onClick:x,disabled:m,className:"rounded-xl",children:m?"Chargement…":c})]})]})})}},45686:(e,s,a)=>{"use strict";a.d(s,{A:()=>l});let l=(0,a(67401).A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},92823:(e,s,a)=>{"use strict";a.d(s,{A:()=>l});let l=(0,a(67401).A)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])}},e=>{var s=s=>e(e.s=s);e.O(0,[352,525,814,130,888,95,441,517,358],()=>s(86480)),_N_E=e.O()}]);