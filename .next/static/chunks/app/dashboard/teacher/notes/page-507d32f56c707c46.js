(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[554],{85349:(e,r,a)=>{Promise.resolve().then(a.bind(a,86381))},86381:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>k});var s=a(95155),t=a(12115),n=a(37334),l=a(35007),i=a(9955),d=a(15785),c=a(14085),o=a(7837),m=a(30814),u=a(33473),x=a(67401);let h=(0,x.A)("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]),p=(0,x.A)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),f=(0,x.A)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),v=(0,x.A)("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);var N=a(29602),g=a(66796),b=a(71183),y=a(6888);function j(e){return null==e||Number.isNaN(e)?"border-[var(--border)] bg-[var(--muted)]/20":e>=10?"border-emerald-500/40 bg-emerald-500/10":e>=8?"border-amber-500/40 bg-amber-500/10":"border-red-500/40 bg-red-500/10"}function w(e){return null==e||Number.isNaN(e)?"text-[var(--foreground)]":e>=10?"text-emerald-600":e>=8?"text-amber-600":"text-red-600"}function k(){let{user:e}=(0,y.A)(),{data:r,loading:a}=(0,n.gR)(),[x,k]=t.useState(null),{data:C,loading:M}=(0,n.uG)(x),{data:S,setGrades:E,refetch:A,loading:F}=(0,n.bp)(x),[z,D]=t.useState(["DS1","DS2","Contr\xf4le"]),[O,T]=t.useState(!1),[L,_]=t.useState(""),[I,V]=t.useState({}),[$,B]=t.useState(!1),[G,J]=t.useState(!1),P=r.find(e=>e.id===x),Z=t.useCallback((e,r)=>{var a,s;let t=null!==(s=null===(a=I["".concat(e,"-").concat(r)])||void 0===a?void 0:a.trim().replace(",","."))&&void 0!==s?s:"",n=""===t?NaN:parseFloat(t);return"number"==typeof n&&!Number.isNaN(n)&&n>=0&&n<=20?n:NaN},[I]),q=t.useCallback((e,r,a)=>{if(""!==a&&!/^\d*[,.]?\d*$/.test(a))return;let s="".concat(e,"-").concat(r);V(e=>({...e,[s]:a}))},[]);t.useEffect(()=>{if(!x||0===C.length){V({});return}let e={};C.forEach(r=>{z.forEach(a=>{var s;let t=S.find(e=>e.studentId===r.id&&e.examName===a),n=null!==(s=null==t?void 0:t.note)&&void 0!==s?s:NaN;e["".concat(r.id,"-").concat(a)]="number"!=typeof n||Number.isNaN(n)?"":String(n)})}),V(e)},[x,z.join(","),C.map(e=>e.id).join(","),S]);let H=t.useMemo(()=>C.map(e=>{let r=z.map(r=>Z(e.id,r)).filter(e=>!Number.isNaN(e));return r.length?r.reduce((e,r)=>e+r,0)/r.length:NaN}),[C,z,Z]),R=t.useMemo(()=>z.map(e=>{let r=C.map(r=>Z(r.id,e)).filter(e=>!Number.isNaN(e));return r.length?r.reduce((e,r)=>e+r,0)/r.length:NaN}),[C,z,Z]),U=t.useCallback(async()=>{if(!x)return;let r=new Date().toISOString().slice(0,10),a=[],s=null;if(C.forEach(e=>{z.forEach(t=>{var n;let l=null===(n=I["".concat(e.id,"-").concat(t)])||void 0===n?void 0:n.trim();if(""===l)return;let i=function(e){if(""===e||null==e)return null;let r="number"==typeof e?e:parseFloat(String(e).replace(",","."));return Number.isNaN(r)?"Veuillez entrer un nombre.":r<0||r>20?"La note doit \xeatre entre ".concat(0," et ").concat(20,"."):null}(l.replace(",","."));if(i){s=i;return}let d=parseFloat(l.replace(",","."));d>=0&&d<=20&&a.push({studentId:e.id,examName:t,note:d,date:r,coefficient:1})})}),s){m.o.error(s);return}J(!0);try{if(await E(a),await A(),B(!0),setTimeout(()=>B(!1),2500),m.o.success("Les notes ont bien \xe9t\xe9 enregistr\xe9es."),P&&(null==e?void 0:e.id))try{await fetch("/api/notifications/create-for-class",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({classId:x,className:P.name,examNames:z,userId:e.id})})}catch(e){}}catch(a){let e=a instanceof Error?a.message:"Erreur lors de l’enregistrement.",r=e.includes("check")||e.includes("constraint")?"Une note doit \xeatre entre 0 et 20.":e;m.o.error(r)}finally{J(!1)}},[x,C,z,I,E,A]),W=()=>{let e=L.trim();e&&!z.includes(e)&&(D([...z,e]),_(""),T(!1))};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"font-display text-2xl font-semibold tracking-tight",children:"Saisie des notes"}),(0,s.jsx)("p",{className:"text-[var(--muted-foreground)]",children:"Choisissez une classe et renseignez les notes. Les moyennes se calculent automatiquement."})]}),(0,s.jsx)(l.Zp,{className:"border-[var(--border)] bg-[var(--card)]",children:(0,s.jsxs)(l.Wu,{className:"flex flex-wrap items-end gap-6 pt-6",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d.J,{htmlFor:"notes-class",className:"text-sm font-medium",children:"Classe"}),(0,s.jsxs)("select",{id:"notes-class",value:null!=x?x:"",onChange:e=>k(e.target.value||null),className:"flex h-11 min-w-[200px] rounded-xl border border-[var(--border)] bg-[var(--background)] px-4 py-2 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-[var(--primary)]","aria-label":"Choisir une classe",children:[(0,s.jsx)("option",{value:"",children:"— Choisir une classe —"}),r.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,s.jsxs)(c.$,{onClick:()=>T(!0),variant:"outline",className:"gap-2 rounded-xl",children:[(0,s.jsx)(u.A,{className:"h-4 w-4"}),"Nouvelle \xe9valuation"]})]})}),(0,s.jsx)(o.lG,{open:O,onOpenChange:T,children:(0,s.jsxs)(o.Cf,{className:"rounded-2xl",children:[(0,s.jsxs)(o.c7,{children:[(0,s.jsx)(o.L3,{children:"Nouvelle \xe9valuation"}),(0,s.jsx)(o.rr,{children:"Ajouter une colonne (ex. DS3, Partiel, Oral)."})]}),(0,s.jsx)("div",{className:"space-y-4 py-2",children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d.J,{htmlFor:"new-exam-name",children:"Nom de l’\xe9valuation"}),(0,s.jsx)(i.p,{id:"new-exam-name",value:L,onChange:e=>_(e.target.value),placeholder:"Ex. DS3",className:"rounded-xl",onKeyDown:e=>"Enter"===e.key&&(e.preventDefault(),W())})]})}),(0,s.jsxs)(o.Es,{children:[(0,s.jsx)(c.$,{variant:"outline",onClick:()=>T(!1),children:"Annuler"}),(0,s.jsx)(c.$,{onClick:W,disabled:!L.trim()||z.includes(L.trim()),children:"Ajouter"})]})]})}),x&&(0,s.jsxs)(l.Zp,{className:"overflow-hidden border-[var(--border)] bg-[var(--card)]",children:[(0,s.jsx)(l.aR,{className:"border-b border-[var(--border)]/50 bg-[var(--muted)]/20",children:(0,s.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"flex h-11 w-11 items-center justify-center rounded-xl bg-[var(--primary)]/20 text-[var(--primary)]",children:(0,s.jsx)(h,{className:"h-5 w-5"})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(l.ZB,{children:["Notes — ",null==P?void 0:P.name]}),(0,s.jsx)(l.BT,{children:'Saisissez les notes puis cliquez sur "Valider les notes". Vert ≥ 10, orange 8–10, rouge < 8.'})]})]}),(0,s.jsx)(c.$,{onClick:U,disabled:G,className:"gap-2 rounded-xl bg-[var(--primary)] font-medium shadow-lg shadow-[var(--primary)]/25 hover:opacity-95",children:G?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"}),"Enregistrement…"]}):$?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p,{className:"h-4 w-4"}),"Notes enregistr\xe9es"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p,{className:"h-4 w-4"}),"Valider les notes"]})})]})}),(0,s.jsx)(l.Wu,{className:"p-0",children:M||F?(0,s.jsx)(g.G,{message:"Chargement des \xe9l\xe8ves et des notes…"}):0===C.length?(0,s.jsx)(b.p,{icon:(0,s.jsx)(h,{className:"h-12 w-12"}),title:"Aucun \xe9l\xe8ve dans cette classe",description:"Ajoutez des \xe9l\xe8ves dans la page Classes."}):(0,s.jsxs)("div",{className:"overflow-x-auto",children:[(0,s.jsxs)("div",{className:"flex min-w-[600px] border-b border-[var(--border)] bg-[var(--muted)]/40",style:{display:"grid",gridTemplateColumns:"minmax(160px, 1fr) repeat(".concat(z.length,", minmax(72px, 80px)) 72px")},children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 px-4 py-3 font-semibold text-[var(--foreground)]",children:[(0,s.jsx)(f,{className:"h-4 w-4 opacity-70"}),"\xc9l\xe8ve"]}),z.map(e=>(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center px-2 py-3 text-center text-sm font-medium text-[var(--foreground)]",children:[e,(0,s.jsx)("span",{className:"text-xs font-normal text-[var(--muted-foreground)]",children:"/20"})]},e)),(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center px-2 py-3 text-center",children:[(0,s.jsx)(v,{className:"mx-auto h-4 w-4 text-[var(--primary)]"}),(0,s.jsx)("span",{className:"text-xs font-semibold",children:"Moy."})]})]}),C.map((e,r)=>{let a=H[r];return(0,s.jsxs)("div",{className:(0,N.cn)("flex min-w-[600px] border-b border-[var(--border)]/70 transition-colors hover:bg-[var(--muted)]/10",r%2==1&&"bg-[var(--muted)]/5"),style:{display:"grid",gridTemplateColumns:"minmax(160px, 1fr) repeat(".concat(z.length,", minmax(72px, 80px)) 72px")},children:[(0,s.jsx)("div",{className:"flex items-center px-4 py-2.5 font-medium text-[var(--foreground)]",children:e.name}),z.map(r=>{var a;let t=null!==(a=I["".concat(e.id,"-").concat(r)])&&void 0!==a?a:"",n=Z(e.id,r);return(0,s.jsx)("div",{className:"flex items-center justify-center p-2",children:(0,s.jsx)("input",{type:"text",inputMode:"decimal",placeholder:"—",className:(0,N.cn)("h-10 w-14 rounded-xl border px-2 text-center text-sm font-medium outline-none transition focus:ring-2 focus:ring-[var(--primary)] focus:ring-offset-2 focus:ring-offset-[var(--card)]",j(n)),value:t,onChange:a=>q(e.id,r,a.target.value)})},r)}),(0,s.jsx)("div",{className:"flex items-center justify-center p-2",children:(0,s.jsx)("span",{className:(0,N.cn)("inline-flex h-10 min-w-[2.5rem] items-center justify-center rounded-xl border px-2 text-sm font-semibold",j(a),w(a)),children:Number.isNaN(a)?"—":a.toFixed(1)})})]},e.id)}),(0,s.jsxs)("div",{className:"flex min-w-[600px] border-t-2 border-[var(--border)] bg-[var(--muted)]/30 font-medium",style:{display:"grid",gridTemplateColumns:"minmax(160px, 1fr) repeat(".concat(z.length,", minmax(72px, 80px)) 72px")},children:[(0,s.jsx)("div",{className:"px-4 py-3 text-sm text-[var(--foreground)]",children:"Moyenne classe"}),R.map((e,r)=>(0,s.jsx)("div",{className:"flex items-center justify-center p-2",children:(0,s.jsx)("span",{className:(0,N.cn)("inline-flex h-10 min-w-[2.5rem] items-center justify-center rounded-xl border px-2 text-sm font-semibold",j(e),w(e)),children:Number.isNaN(e)?"—":e.toFixed(1)})},r)),(0,s.jsx)("div",{})]})]})})]})]})}}},e=>{var r=r=>e(e.s=r);e.O(0,[352,525,814,130,888,95,441,517,358],()=>r(85349)),_N_E=e.O()}]);