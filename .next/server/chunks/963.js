exports.id=963,exports.ids=[963],exports.modules={56379:(e,t,r)=>{Promise.resolve().then(r.bind(r,17913)),Promise.resolve().then(r.bind(r,8430)),Promise.resolve().then(r.bind(r,44374)),Promise.resolve().then(r.bind(r,56814))},9523:(e,t,r)=>{Promise.resolve().then(r.bind(r,72789)),Promise.resolve().then(r.bind(r,65242)),Promise.resolve().then(r.bind(r,63066)),Promise.resolve().then(r.bind(r,91542))},16001:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,13219,23)),Promise.resolve().then(r.t.bind(r,34863,23)),Promise.resolve().then(r.t.bind(r,25155,23)),Promise.resolve().then(r.t.bind(r,40802,23)),Promise.resolve().then(r.t.bind(r,9350,23)),Promise.resolve().then(r.t.bind(r,48530,23)),Promise.resolve().then(r.t.bind(r,88921,23))},52449:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,66959,23)),Promise.resolve().then(r.t.bind(r,33875,23)),Promise.resolve().then(r.t.bind(r,88903,23)),Promise.resolve().then(r.t.bind(r,57174,23)),Promise.resolve().then(r.t.bind(r,84178,23)),Promise.resolve().then(r.t.bind(r,87190,23)),Promise.resolve().then(r.t.bind(r,61365,23))},72789:(e,t,r)=>{"use strict";r.d(t,{ThemeProvider:()=>n});var s=r(45512);r(58009);var i=r(3371);function n({children:e,...t}){return(0,s.jsx)(i.N,{...t,children:e})}},65242:(e,t,r)=>{"use strict";r.d(t,{A:()=>c,AuthProvider:()=>u});var s=r(45512),i=r(58009),n=r(58957),o=r(24559),a=r(42445);let l=i.createContext(null);function d(e){return{id:e.id,name:e.name,email:e.email,role:e.role,mustChangePassword:e.must_change_password??!1}}function u({children:e}){let[t,r]=i.useState(null),[u,c]=i.useState(!1),[m,f]=i.useState(null),[h,p]=i.useState([]),[v,w]=i.useState(null),[_,b]=i.useState(""),[g,P]=i.useState(""),[C,x]=i.useState(!1),y=i.useMemo(()=>(0,o.A)(),[]),S=i.useCallback(e=>{if(!e?.user){w(null),b(""),P(""),x(!1),f(null);return}w(e.user.id),b(e.user.user_metadata?.name??e.user.email??""),P(e.user.email??""),x(e.user.user_metadata?.must_change_password===!0),(0,a.CH)(y,e.user.id).then(e=>{e?f(d(e)):f(null)})},[y]);i.useEffect(()=>{if(!y){r((0,n.iT)()),c(!0);return}let e=!1;y.auth.getSession().then(({data:{session:t}})=>{e||(c(!0),S(t))});let{data:{subscription:t}}=y.auth.onAuthStateChange((t,r)=>{e||S(r)});return(0,a.lR)(y).then(t=>{e||p(t.map(d))}),()=>{e=!0,t.unsubscribe()}},[y,S]);let E=i.useCallback(async()=>{y&&p((await (0,a.lR)(y)).map(d))},[y]),A=i.useCallback(e=>{if(y)return;let t=(0,n.lo)().find(t=>t.id===e);t&&(0,n.mc)(t.role),(0,n.cq)(e),r(e)},[y]),T=i.useCallback(()=>{if(y){y.auth.signOut(),f(null);return}(0,n.ri)(),r(null)},[y]),k=i.useCallback(e=>{(0,n.mc)(e)},[]),j=!!y,q=j?h:[],I=j?v??m?.id??null:u?(0,n.iT)():t,M={id:"",name:"",email:"",role:"student",mustChangePassword:!1},N=I?j?m?.id===I?m:v===I?{id:I,name:_||"\xc9l\xe8ve",email:g,role:"student",mustChangePassword:C}:h.find(e=>e.id===I)??h[0]??M:(0,n.lo)().find(e=>e.id===I)??M:M,U={...N,mustChangePassword:N.mustChangePassword??C},R=U?.role??"student",V=!!I&&u,L=i.useMemo(()=>({user:U,role:R,isLoggedIn:V,setRole:k,login:A,logout:T,allUsers:q,refetchProfiles:E,useSupabase:j}),[U,R,V,k,A,T,q,E,j]);return(0,s.jsx)(l.Provider,{value:L,children:e})}function c(){let e=i.useContext(l);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},63066:(e,t,r)=>{"use strict";r.d(t,{SidebarProvider:()=>o,c:()=>a});var s=r(45512),i=r(58009);let n=i.createContext(null);function o({children:e}){let[t,r]=i.useState(!1),[o,a]=i.useState(!1),l=i.useMemo(()=>({mobileOpen:t,setMobileOpen:r,collapsed:o,setCollapsed:a}),[t,o]);return(0,s.jsx)(n.Provider,{value:l,children:e})}function a(){let e=i.useContext(n);if(!e)throw Error("useSidebar must be used within SidebarProvider");return e}},58957:(e,t,r)=>{"use strict";r.d(t,{QF:()=>u,cq:()=>a,iT:()=>o,jw:()=>c,lo:()=>d,mc:()=>n,ri:()=>l});let s=[{id:"1",name:"Admin SVT",email:"admin@svt-lycee.fr",role:"admin"},{id:"2",name:"Marie Dupont",email:"marie.dupont@svt-lycee.fr",role:"teacher"},{id:"3",name:"Lucas Martin",email:"lucas.martin@svt-lycee.fr",role:"student"},{id:"4",name:"Emma Bernard",email:"emma.bernard@svt-lycee.fr",role:"student"},{id:"5",name:"Hugo Petit",email:"hugo.petit@svt-lycee.fr",role:"student"},{id:"6",name:"L\xe9a Moreau",email:"lea.moreau@svt-lycee.fr",role:"student"}],i=(s[0],s[1],s[2],"eleve123");function n(e){}function o(){return null}function a(e){}function l(){}function d(){return s}function u(e,t){!function(){let e={},t=!1;for(let t of s){let r=t.email.toLowerCase();e[r]||(e[r]="student"===t.role?i:"demo")}}();let r=e.trim().toLowerCase(),n=s.find(e=>e.email.toLowerCase()===r);if(!n)return null;let o={}[r];return o&&o===t.trim()?n:null}function c(e,t){var r,i;let n=t.trim().toLowerCase();if(s.some(e=>e.email.toLowerCase()===n))throw Error("Un utilisateur avec cet email existe d\xe9j\xe0.");let o={id:"s-"+Date.now(),name:e.trim(),email:t.trim(),role:"student"};return[...s],i=o.email,o}},42445:(e,t,r)=>{"use strict";async function s(e){let{data:t,error:r}=await e.from("classes").select("id, name").order("name");if(r)throw Error(r.message);let s=t??[];if(0===s.length)return[];let i=s.map(e=>e.id),{data:n,error:o}=await e.from("class_students").select("class_id, user_id").in("class_id",i);if(o)throw Error(o.message);let a=new Map;for(let e of i)a.set(e,[]);for(let e of n??[]){let t=a.get(e.class_id);t&&t.push(e.user_id)}return s.map(e=>({id:e.id,name:e.name,studentIds:a.get(e.id)??[]}))}async function i(e,t,r){let{data:s,error:i}=await e.from("classes").insert({name:t,created_by:r}).select("id, name").single();if(i)throw Error(i.message);return{id:s.id,name:s.name,studentIds:[]}}async function n(e,t,r){let{error:s}=await e.from("classes").update({name:r}).eq("id",t);if(s)throw Error(s.message)}async function o(e,t){let{error:r}=await e.from("classes").delete().eq("id",t);if(r)throw Error(r.message)}async function a(e,t){let{data:r,error:s}=await e.from("class_students").select("user_id").eq("class_id",t);if(s)throw Error(s.message);let i=(r??[]).map(e=>e.user_id);if(0===i.length)return[];let{data:n,error:o}=await e.from("profiles").select("id, name, email").in("id",i);if(o)throw Error(o.message);return(n??[]).map(e=>({id:e.id,name:e.name,email:e.email}))}async function l(e,t,r){let{error:s}=await e.from("class_students").insert({class_id:t,user_id:r});if(s)throw Error(s.message)}async function d(e,t,r){let{error:s}=await e.from("class_students").delete().eq("class_id",t).eq("user_id",r);if(s)throw Error(s.message)}function u(e){return{studentId:e.student_id,examName:e.exam_name,note:e.note,date:e.date,coefficient:e.coefficient??void 0}}async function c(e,t){let{data:r,error:s}=await e.from("grades").select("student_id, exam_name, note, date, coefficient").eq("class_id",t);if(s)throw Error(s.message);return(r??[]).map(u)}async function m(e,t,r){if(0===r.length)return;let s=r.map(e=>({class_id:t,student_id:e.studentId,exam_name:e.examName,note:e.note,date:e.date,coefficient:e.coefficient??null})),{error:i}=await e.from("grades").upsert(s,{onConflict:"class_id,student_id,exam_name"});if(i)throw Error(i.message)}function f(e,t){return`${t}/storage/v1/object/public/corrections/${e}`}async function h(e,t){let r=e.from("corrections").select("id, title, class_id, file_path, file_name, uploaded_at");t?.classId!==void 0&&null!==t.classId&&(r=r.eq("class_id",t.classId));let{data:s,error:i}=await r.order("uploaded_at",{ascending:!1});if(i)throw Error(i.message);return(s??[]).map(e=>({id:e.id,title:e.title,classId:e.class_id,fileUrl:f(e.file_path,"https://ycxwrlkqfoiokmogxlfd.supabase.co"),filePath:e.file_path,fileName:e.file_name,uploadedAt:e.uploaded_at}))}async function p(e,t){let{data:r,error:s}=await e.from("corrections").insert({title:t.title,class_id:t.classId,file_path:t.filePath,file_name:t.fileName,uploaded_by:t.uploadedBy}).select("id, title, class_id, file_path, file_name, uploaded_at").single();if(s)throw Error(s.message);return{id:r.id,title:r.title,classId:r.class_id,fileUrl:f(r.file_path,"https://ycxwrlkqfoiokmogxlfd.supabase.co"),filePath:r.file_path,fileName:r.file_name,uploadedAt:r.uploaded_at}}async function v(e,t){let{error:r}=await e.from("corrections").delete().eq("id",t);if(r)throw Error(r.message)}async function w(e,t){let{error:r}=await e.storage.from("corrections").remove([t]);if(r)throw Error(r.message)}r.d(t,{CH:()=>C,GH:()=>p,Gd:()=>w,KT:()=>i,Sy:()=>m,Yh:()=>l,eJ:()=>n,lR:()=>P,n0:()=>a,se:()=>h,us:()=>c,vK:()=>s,w$:()=>v,w4:()=>d,wt:()=>o});let _="id, name, email, role, must_change_password",b="id, name, email, role";function g(e){let t=e?.message??"";return t.includes("must_change_password")||t.includes("column")&&t.includes("does not exist")}async function P(e,t){let r=e.from("profiles").select(_);t&&(r=r.eq("role",t));let{data:s,error:i}=await r.order("name");if(i&&g(i)){r=e.from("profiles").select(b),t&&(r=r.eq("role",t));let s=await r.order("name");if(s.error)throw Error(s.error.message);return(s.data??[]).map(e=>({...e,must_change_password:!1}))}if(i)throw Error(i.message);return(s??[]).map(e=>({...e,must_change_password:e.must_change_password??!1}))}async function C(e,t){let{data:r,error:s}=await e.from("profiles").select(_).eq("id",t).single();if(s&&g(s)){let r=await e.from("profiles").select(b).eq("id",t).single();if(r.error&&"PGRST116"!==r.error.code)throw Error(r.error.message);return r.data?{...r.data,must_change_password:!1}:null}if(s&&"PGRST116"!==s.code)throw Error(s.message);return r?{...r,must_change_password:r.must_change_password??!1}:null}},24559:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var s=r(77588);let i=null;function n(){let e="https://ycxwrlkqfoiokmogxlfd.supabase.co",t=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY??"sb_publishable_Ciw05QM2VyvN8U5gbrkJKA_GlJl-yA0";return e&&t?(i||(i=(0,s.UU)(e,t)),i):null}},19611:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h,metadata:()=>m,viewport:()=>f});var s=r(62740),i=r(38799),n=r.n(i),o=r(57632),a=r.n(o),l=r(56814);r(82704);var d=r(17913),u=r(8430),c=r(44374);let m={title:"SVT Notes â€” Gestion des notes",description:"Plateforme de gestion des notes pour les professeurs de SVT"},f={width:"device-width",initialScale:1,maximumScale:5};function h({children:e}){return(0,s.jsx)("html",{lang:"fr",suppressHydrationWarning:!0,className:`${n().variable} ${a().variable}`,children:(0,s.jsx)("body",{className:"min-h-screen font-sans antialiased",children:(0,s.jsxs)(d.ThemeProvider,{attribute:"class",defaultTheme:"dark",enableSystem:!1,disableTransitionOnChange:!1,children:[(0,s.jsx)(u.AuthProvider,{children:(0,s.jsx)(c.SidebarProvider,{children:e})}),(0,s.jsx)(l.Toaster,{richColors:!0,position:"top-center",closeButton:!0})]})})})}},17913:(e,t,r)=>{"use strict";r.d(t,{ThemeProvider:()=>s});let s=(0,r(46760).registerClientReference)(function(){throw Error("Attempted to call ThemeProvider() from the server but ThemeProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\SQMV0257\\svtProject\\components\\theme-provider.tsx","ThemeProvider")},8430:(e,t,r)=>{"use strict";r.d(t,{AuthProvider:()=>i});var s=r(46760);let i=(0,s.registerClientReference)(function(){throw Error("Attempted to call AuthProvider() from the server but AuthProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\SQMV0257\\svtProject\\contexts\\auth-context.tsx","AuthProvider");(0,s.registerClientReference)(function(){throw Error("Attempted to call useAuth() from the server but useAuth is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\SQMV0257\\svtProject\\contexts\\auth-context.tsx","useAuth")},44374:(e,t,r)=>{"use strict";r.d(t,{SidebarProvider:()=>i});var s=r(46760);let i=(0,s.registerClientReference)(function(){throw Error("Attempted to call SidebarProvider() from the server but SidebarProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\SQMV0257\\svtProject\\contexts\\sidebar-context.tsx","SidebarProvider");(0,s.registerClientReference)(function(){throw Error("Attempted to call useSidebar() from the server but useSidebar is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\SQMV0257\\svtProject\\contexts\\sidebar-context.tsx","useSidebar")},82704:()=>{}};