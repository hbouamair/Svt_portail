(()=>{var e={};e.id=800,e.ids=[800],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},32890:(e,r,s)=>{"use strict";s.r(r),s.d(r,{patchFetch:()=>g,routeModule:()=>d,serverHooks:()=>m,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>f});var t={};s.r(t),s.d(t,{POST:()=>l});var o=s(42706),a=s(28203),i=s(45994),n=s(39187),u=s(61487),c=s(62545);async function l(e){try{let r=await e.json(),s="string"==typeof r?.classId?r.classId:"",t="string"==typeof r?.className?r.className:"",o=Array.isArray(r?.examNames)?r.examNames.filter(e=>"string"==typeof e):[],a="string"==typeof r?.userId?r.userId:"";if(!s||!t||!a)return n.NextResponse.json({error:"classId, className et userId requis."},{status:400});let i=(0,u.H)(),l=await (0,c.CH)(i,a);if(!l||!["teacher","admin"].includes(l.role))return n.NextResponse.json({error:"Non autoris\xe9."},{status:403});return await (0,c.sL)(i,s,t,o),n.NextResponse.json({ok:!0})}catch(e){return console.error("Create notifications error:",e),n.NextResponse.json({error:"Erreur lors de la cr\xe9ation des notifications."},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/notifications/create-for-class/route",pathname:"/api/notifications/create-for-class",filename:"route",bundlePath:"app/api/notifications/create-for-class/route"},resolvedPagePath:"C:\\Users\\SQMV0257\\svtProject\\app\\api\\notifications\\create-for-class\\route.ts",nextConfigOutput:"",userland:t}),{workAsyncStorage:p,workUnitAsyncStorage:f,serverHooks:m}=d;function g(){return(0,i.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:f})}},96487:()=>{},78335:()=>{},62545:(e,r,s)=>{"use strict";async function t(e,r,s,t){let{data:o,error:a}=await e.from("class_students").select("user_id").eq("class_id",r);if(a)throw Error(a.message);let i=(o??[]).map(e=>e.user_id);if(0===i.length)return;let n=t.length>0?t.join(", "):"les \xe9valuations",u=`Les notes du ${n} pour la classe ${s} sont disponibles dans votre espace.`,c=i.map(e=>({user_id:e,title:"Nouvelles notes disponibles",message:u})),{error:l}=await e.from("notifications").insert(c);if(l)throw Error(l.message)}function o(e){let r=e?.message??"";return r.includes("must_change_password")||r.includes("column")&&r.includes("does not exist")}async function a(e,r){let{data:s,error:t}=await e.from("profiles").select("id, name, email, role, must_change_password").eq("id",r).single();if(t&&o(t)){let s=await e.from("profiles").select("id, name, email, role").eq("id",r).single();if(s.error&&"PGRST116"!==s.error.code)throw Error(s.error.message);return s.data?{...s.data,must_change_password:!1}:null}if(t&&"PGRST116"!==t.code)throw Error(t.message);return s?{...s,must_change_password:s.must_change_password??!1}:null}async function i(e,r){let{error:s}=await e.from("profiles").upsert(r,{onConflict:"id"});if(s&&o(s)){let{id:s,name:t,email:o,role:a}=r,{error:i}=await e.from("profiles").upsert({id:s,name:t,email:o,role:a},{onConflict:"id"});if(i)throw Error(i.message);return}if(s)throw Error(s.message)}s.d(r,{CH:()=>a,PP:()=>i,sL:()=>t})},61487:(e,r,s)=>{"use strict";s.d(r,{H:()=>o});var t=s(47752);function o(){let e="https://ycxwrlkqfoiokmogxlfd.supabase.co",r=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!r)throw Error("Missing NEXT_PUBLIC_SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY");return(0,t.UU)(e,r,{auth:{autoRefreshToken:!1,persistSession:!1}})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[638,452,752],()=>s(32890));module.exports=t})();