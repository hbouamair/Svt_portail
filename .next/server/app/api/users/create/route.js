(()=>{var e={};e.id=441,e.ids=[441],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},95275:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>g,routeModule:()=>p,serverHooks:()=>f,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>m});var s={};t.r(s),t.d(s,{POST:()=>c});var a=t(42706),o=t(28203),i=t(45994),n=t(39187),u=t(61487),l=t(62545);async function c(e){try{let r=await e.json(),t="string"==typeof r?.email?r.email.trim().toLowerCase():"",s="string"==typeof r?.name?r.name.trim():"";if(!t||!s)return n.NextResponse.json({error:"Email et nom requis."},{status:400});let a=function(e){let r=e.trim().toLowerCase().replace(/\s+/g,"").replace(/[àáâãäå]/gi,"a").replace(/[èéêë]/gi,"e").replace(/[ìíîï]/gi,"i").replace(/[òóôõö]/gi,"o").replace(/[ùúûü]/gi,"u").replace(/[ç]/gi,"c").replace(/[^a-z0-9]/g,"");return`${r||"eleve"}Svt2026!`}(s),o=(0,u.H)(),{data:i,error:c}=await o.auth.admin.createUser({email:t,password:a,email_confirm:!0,user_metadata:{name:s,must_change_password:!0}});if(c){let e=c.message;if(e.includes("already registered")||e.includes("already exists"))return n.NextResponse.json({error:"Un compte existe d\xe9j\xe0 avec cet email."},{status:409});return n.NextResponse.json({error:e},{status:400})}if(!i?.user?.id)return n.NextResponse.json({error:"Cr\xe9ation du compte \xe9chou\xe9e."},{status:500});return await (0,l.PP)(o,{id:i.user.id,name:s,email:t,role:"student",must_change_password:!0}),n.NextResponse.json({id:i.user.id,name:s,email:t})}catch(e){return console.error("Create user error:",e),n.NextResponse.json({error:"Erreur lors de la cr\xe9ation du compte."},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/users/create/route",pathname:"/api/users/create",filename:"route",bundlePath:"app/api/users/create/route"},resolvedPagePath:"C:\\Users\\SQMV0257\\svtProject\\app\\api\\users\\create\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:d,workUnitAsyncStorage:m,serverHooks:f}=p;function g(){return(0,i.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:m})}},96487:()=>{},78335:()=>{},62545:(e,r,t)=>{"use strict";async function s(e,r,t,s){let{data:a,error:o}=await e.from("class_students").select("user_id").eq("class_id",r);if(o)throw Error(o.message);let i=(a??[]).map(e=>e.user_id);if(0===i.length)return;let n=s.length>0?s.join(", "):"les \xe9valuations",u=`Les notes du ${n} pour la classe ${t} sont disponibles dans votre espace.`,l=i.map(e=>({user_id:e,title:"Nouvelles notes disponibles",message:u})),{error:c}=await e.from("notifications").insert(l);if(c)throw Error(c.message)}function a(e){let r=e?.message??"";return r.includes("must_change_password")||r.includes("column")&&r.includes("does not exist")}async function o(e,r){let{data:t,error:s}=await e.from("profiles").select("id, name, email, role, must_change_password").eq("id",r).single();if(s&&a(s)){let t=await e.from("profiles").select("id, name, email, role").eq("id",r).single();if(t.error&&"PGRST116"!==t.error.code)throw Error(t.error.message);return t.data?{...t.data,must_change_password:!1}:null}if(s&&"PGRST116"!==s.code)throw Error(s.message);return t?{...t,must_change_password:t.must_change_password??!1}:null}async function i(e,r){let{error:t}=await e.from("profiles").upsert(r,{onConflict:"id"});if(t&&a(t)){let{id:t,name:s,email:a,role:o}=r,{error:i}=await e.from("profiles").upsert({id:t,name:s,email:a,role:o},{onConflict:"id"});if(i)throw Error(i.message);return}if(t)throw Error(t.message)}t.d(r,{CH:()=>o,PP:()=>i,sL:()=>s})},61487:(e,r,t)=>{"use strict";t.d(r,{H:()=>a});var s=t(47752);function a(){let e="https://ycxwrlkqfoiokmogxlfd.supabase.co",r=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!r)throw Error("Missing NEXT_PUBLIC_SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY");return(0,s.UU)(e,r,{auth:{autoRefreshToken:!1,persistSession:!1}})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[638,452,752],()=>t(95275));module.exports=s})();